<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediiQuick ‚Äî My Orders</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --green: #22c55e;
            --green-dark: #16a34a;
            --green-light: #dcfce7;
            --green-mid: #bbf7d0;
            --orange: #f97316;
            --text: #111827;
            --text-muted: #6b7280;
            --border: #e5e7eb;
            --bg: #f5f7fa;
            --white: #ffffff;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* HEADER */
        .header {
            background: #fff;
            box-shadow: 0 2px 12px rgba(0, 0, 0, .08);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 12px 0;
        }

        .header-inner {
            width: 100%;
            padding: 0 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .logo img {
            width: 38px;
            height: 38px;
            border-radius: 10px;
        }

        .logo h1 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1a1a2e;
        }

        .logo span {
            color: #16a34a;
        }

        .header-search {
            flex: 1;
            max-width: 480px;
            display: flex;
            align-items: center;
            background: #f3f4f6;
            border-radius: 50px;
            padding: 8px 18px;
            gap: 10px;
        }

        .header-search input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 14px;
            font-family: 'Poppins', sans-serif;
        }

        .header-search input::placeholder {
            color: #9ca3af;
        }

        .header-search i {
            color: #9ca3af;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #f3f4f6;
            border: none;
            padding: 9px 18px;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 13px;
            color: #374151;
            cursor: pointer;
            text-decoration: none;
        }

        .back-btn:hover {
            background: #e5e7eb;
        }

        /* MAIN */
        main {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
            padding: 36px 24px 60px;
        }

        .page-title {
            font-size: 1.6rem;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .page-sub {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 28px;
        }

        /* TABS */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 28px;
        }

        .tab {
            padding: 12px 22px;
            font-size: 0.88rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2.5px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .tab.active {
            color: var(--green-dark);
            border-bottom-color: var(--green);
        }

        .tab:hover {
            color: var(--green-dark);
        }

        /* STATS */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 14px;
            margin-bottom: 28px;
        }

        .stat-card {
            background: white;
            border: 1.5px solid var(--border);
            border-radius: 14px;
            padding: 16px 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stat-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .si-green {
            background: var(--green-light);
        }

        .si-orange {
            background: #fff7ed;
        }

        .si-purple {
            background: #f5f3ff;
        }

        .si-blue {
            background: #eff6ff;
        }

        .stat-label {
            font-size: 0.72rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .stat-val {
            font-size: 1.2rem;
            font-weight: 800;
            margin-top: 2px;
        }

        /* EMPTY */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: 16px;
            border: 1.5px solid var(--border);
        }

        .empty-state .ei {
            font-size: 4rem;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 1.15rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .shop-btn {
            display: inline-block;
            background: var(--green-dark);
            color: white;
            padding: 12px 28px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 14px;
            text-decoration: none;
            transition: background 0.2s;
        }

        .shop-btn:hover {
            background: #15803d;
        }

        /* ORDER CARD */
        .order-card {
            background: white;
            border: 1.5px solid var(--border);
            border-radius: 16px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: box-shadow 0.2s, border-color 0.2s;
            animation: fadeUp 0.4s ease both;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(16px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .order-card:hover {
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.07);
            border-color: #d1fae5;
        }

        .order-top {
            padding: 14px 20px;
            background: #f8fffe;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        .order-meta {
            display: flex;
            align-items: center;
            gap: 14px;
            flex-wrap: wrap;
        }

        .order-id-tag {
            background: var(--green-light);
            color: var(--green-dark);
            font-size: 0.72rem;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 6px;
            letter-spacing: 0.5px;
        }

        .order-date {
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .order-date strong {
            color: var(--text);
            font-weight: 600;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.78rem;
            font-weight: 700;
            white-space: nowrap;
        }

        .badge-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
        }

        .badge-orange {
            background: #fff7ed;
            color: #c2410c;
        }

        .badge-orange .badge-dot {
            background: var(--orange);
            animation: blink 1.5s infinite;
        }

        .badge-green {
            background: var(--green-light);
            color: var(--green-dark);
        }

        .badge-green .badge-dot {
            background: var(--green);
            animation: blink 1.5s infinite;
        }

        .badge-check {
            background: #f0fdf4;
            color: #15803d;
        }

        .badge-check .badge-dot {
            background: #4ade80;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        .order-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        @media(max-width:700px) {
            .order-body {
                grid-template-columns: 1fr;
            }
        }

        .order-left {
            padding: 18px 20px;
            border-right: 1px solid var(--border);
        }

        .order-right {
            padding: 18px 20px;
        }

        .section-label {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .med-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 9px 0;
            border-bottom: 1px solid var(--border);
        }

        .med-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .med-item:first-child {
            padding-top: 0;
        }

        .med-img {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            background: var(--bg);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .med-off {
            position: absolute;
            top: 0;
            left: 0;
            background: var(--orange);
            color: white;
            font-size: 0.42rem;
            font-weight: 700;
            padding: 1px 3px;
            border-radius: 0 0 4px 0;
        }

        .med-info {
            flex: 1;
            min-width: 0;
        }

        .med-name {
            font-weight: 700;
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .med-sub {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 1px;
        }

        .med-price {
            margin-left: auto;
            text-align: right;
            flex-shrink: 0;
        }

        .med-price .curr {
            font-weight: 800;
            font-size: 0.9rem;
            color: var(--green-dark);
        }

        .med-price .orig {
            font-size: 0.68rem;
            color: var(--text-muted);
            text-decoration: line-through;
        }

        .med-price .qty {
            font-size: 0.68rem;
            color: var(--text-muted);
        }

        .tracker-steps {
            display: flex;
            align-items: flex-start;
            margin: 8px 0 18px;
        }

        .t-step {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            gap: 5px;
        }

        .t-step::after {
            content: '';
            position: absolute;
            top: 13px;
            left: calc(50% + 13px);
            width: calc(100% - 26px);
            height: 2px;
            background: var(--border);
            z-index: 0;
        }

        .t-step:last-child::after {
            display: none;
        }

        .t-step.done::after {
            background: var(--green);
        }

        .t-icon {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: 2px solid var(--border);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            position: relative;
            z-index: 1;
            transition: all 0.3s;
        }

        .t-step.done .t-icon {
            background: var(--green);
            border-color: var(--green);
            color: white;
        }

        .t-step.active .t-icon {
            border-color: var(--green);
            background: var(--green-light);
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
            animation: ring 2s infinite;
        }

        @keyframes ring {

            0%,
            100% {
                box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
            }

            50% {
                box-shadow: 0 0 0 8px rgba(34, 197, 94, 0.08);
            }
        }

        .t-label {
            font-size: 0.58rem;
            font-weight: 600;
            text-align: center;
            color: var(--text-muted);
            line-height: 1.3;
            max-width: 52px;
        }

        .t-step.done .t-label,
        .t-step.active .t-label {
            color: var(--green-dark);
        }

        .eta-box {
            border-radius: 12px;
            padding: 12px 14px;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1.5px solid;
        }

        .eta-icon {
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .eta-label {
            font-size: 0.68rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .eta-time {
            font-size: 1.1rem;
            font-weight: 800;
            margin-top: 2px;
        }

        .eta-addr {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .price-box {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 10px 12px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.78rem;
            color: var(--text-muted);
            padding: 3px 0;
        }

        .price-row.total {
            border-top: 1.5px solid var(--border);
            margin-top: 5px;
            padding-top: 7px;
            font-size: 0.9rem;
            font-weight: 800;
            color: var(--text);
        }

        .price-row.total span:last-child {
            color: var(--green-dark);
        }

        .price-row .save {
            color: var(--green);
            font-weight: 600;
        }

        .order-actions {
            padding: 12px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
            background: #fafafa;
        }

        .order-total-tag {
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .order-total-tag strong {
            color: var(--green-dark);
            font-size: 0.95rem;
        }

        .action-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 7px 14px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background: var(--green);
            color: white;
        }

        .btn-primary:hover {
            background: var(--green-dark);
        }

        .btn-outline {
            background: white;
            color: var(--text);
            border: 1.5px solid var(--border);
        }

        .btn-outline:hover {
            border-color: var(--green);
            color: var(--green-dark);
        }

        .btn-red {
            background: white;
            color: #dc2626;
            border: 1.5px solid #fecaca;
        }

        .btn-red:hover {
            background: #fef2f2;
        }

        #toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            background: #1a1a2e;
            color: #fff;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            z-index: 999;
            transition: transform .3s;
            pointer-events: none;
            white-space: nowrap;
        }

        #toast.show {
            transform: translateX(-50%) translateY(0);
        }

        @media(max-width:600px) {
            .header-inner {
                padding: 0 16px;
            }

            .header-search {
                display: none;
            }

            main {
                padding: 20px 14px 40px;
            }

            .order-left {
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
        }
    </style>
</head>

<body>

    <div id="toast"></div>

    <header class="header">
        <div class="header-inner">
            <a href="index.html" class="logo">
                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/6ab4d9fc-53f8-46cf-b443-33dacb111091.png"
                    alt="MediiQuick">
                <h1>Medii<span>Quick</span></h1>
            </a>
            <div class="header-search">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search from 20 medicines...">
            </div>
            <div class="header-right">
                <a href="all-medicines.html" class="back-btn"><i class="fas fa-pills"></i> Order Medicines</a>
                <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Home</a>
            </div>
        </div>
    </header>

    <main>
        <div class="page-title">My Orders üì¶</div>
        <div class="page-sub">Track your medicines ‚Äî delivered in 30 minutes ‚ö°</div>

        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-icon si-green">üì¶</div>
                <div>
                    <div class="stat-label">Total Orders</div>
                    <div class="stat-val" id="statTotal" style="color:var(--green-dark)">0</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon si-orange">üö¥</div>
                <div>
                    <div class="stat-label">Active</div>
                    <div class="stat-val" id="statActive" style="color:var(--orange)">0</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon si-green">‚úÖ</div>
                <div>
                    <div class="stat-label">Delivered</div>
                    <div class="stat-val" id="statDelivered" style="color:var(--green-dark)">0</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon si-purple">üíä</div>
                <div>
                    <div class="stat-label">Total Spent</div>
                    <div class="stat-val" id="statSpent" style="color:#7c3aed">‚Çπ0</div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" id="tabAll" onclick="switchTab('all')">All Orders (<span id="cntAll">0</span>)</div>
            <div class="tab" id="tabActive" onclick="switchTab('active')">Active (<span id="cntActive">0</span>)</div>
            <div class="tab" id="tabDelivered" onclick="switchTab('delivered')">Delivered (<span
                    id="cntDelivered">0</span>)</div>
        </div>

        <div id="ordersList"></div>
    </main>

    <script>
        const ALL_MEDS = [
            { id: 'm1', name: 'Paracetamol', sub: 'Paracetamol 500mg', price: 40, mrp: 50 },
            { id: 'm2', name: 'Ibuprofen 200', sub: 'Ibuprofen 200mg', price: 64, mrp: 80 },
            { id: 'm3', name: 'Combiflam', sub: 'Ibuprofen+Paracetamol', price: 55, mrp: 70 },
            { id: 'm4', name: 'Nimesulide 100', sub: 'Nimesulide 100mg', price: 22, mrp: 28 },
            { id: 'm5', name: 'Amoxicillin 500', sub: 'Amoxicillin 500mg', price: 96, mrp: 120 },
            { id: 'm6', name: 'Azithromycin 250', sub: 'Azithromycin 250mg', price: 120, mrp: 150 },
            { id: 'm7', name: 'Ciprofloxacin 500', sub: 'Ciprofloxacin 500mg', price: 104, mrp: 130 },
            { id: 'm8', name: 'Doxycycline 100', sub: 'Doxycycline 100mg', price: 48, mrp: 60 },
            { id: 'm9', name: 'Metformin 500', sub: 'Metformin 500mg', price: 72, mrp: 90 },
            { id: 'm10', name: 'Atorvastatin 20', sub: 'Atorvastatin 20mg', price: 88, mrp: 110 },
            { id: 'm11', name: 'Losartan 50', sub: 'Losartan 50mg', price: 80, mrp: 100 },
            { id: 'm12', name: 'Amlodipine 5', sub: 'Amlodipine 5mg', price: 68, mrp: 85 },
            { id: 'm13', name: 'Omeprazole 20', sub: 'Omeprazole 20mg', price: 56, mrp: 70 },
            { id: 'm14', name: 'Levothyroxine 50', sub: 'Levothyroxine 50mcg', price: 128, mrp: 160 },
            { id: 'm15', name: 'Cetirizine 10', sub: 'Cetirizine 10mg', price: 48, mrp: 60 },
            { id: 'm16', name: 'Montelukast 10', sub: 'Montelukast 10mg', price: 112, mrp: 140 },
            { id: 'm17', name: 'Salbutamol Inhaler', sub: 'Salbutamol 100mcg', price: 176, mrp: 220 },
            { id: 'm18', name: 'Prednisone 10', sub: 'Prednisone 10mg', price: 104, mrp: 130 },
            { id: 'm19', name: 'Sertraline 50', sub: 'Sertraline 50mg', price: 144, mrp: 180 },
            { id: 'm20', name: 'Fluoxetine 20', sub: 'Fluoxetine 20mg', price: 136, mrp: 170 },
        ];

        function getMed(id) { return ALL_MEDS.find(m => m.id === id) || {}; }

        // Auto-advance status based on time since order placed
        // 0‚Äì2 min = confirmed, 2‚Äì5 min = packing, 5‚Äì25 min = on_the_way, 25+ min = delivered
        function getStatus(order) {
            const min = (Date.now() - order.placedAt) / 60000;
            if (min < 2) return 'confirmed';
            if (min < 5) return 'packing';
            if (min < 25) return 'on_the_way';
            return 'delivered';
        }

        const STATUS_CONFIG = {
            confirmed: { label: 'Order Confirmed', badge: 'badge-orange', activeStep: 1, etaIcon: 'üìã', etaLabel: 'Preparing your order', etaColor: '#c2410c', etaBg: 'linear-gradient(135deg,#fff7ed,#fffbeb)', etaBorder: '#fed7aa' },
            packing: { label: 'Being Packed', badge: 'badge-orange', activeStep: 2, etaIcon: 'üì¶', etaLabel: 'Packing your medicines', etaColor: '#c2410c', etaBg: 'linear-gradient(135deg,#fff7ed,#fffbeb)', etaBorder: '#fed7aa' },
            on_the_way: { label: 'On the Way üö¥', badge: 'badge-green', activeStep: 3, etaIcon: 'üö¥', etaLabel: 'Arriving In', etaColor: '#15803d', etaBg: 'linear-gradient(135deg,#dcfce7,#f0fdf4)', etaBorder: '#bbf7d0' },
            delivered: { label: 'Delivered ‚úì', badge: 'badge-check', activeStep: 4 },
        };

        let currentTab = 'all';
        let orders = [];

        function loadOrders() {
            try { orders = JSON.parse(localStorage.getItem('mq_orders') || '[]'); }
            catch (e) { orders = []; }
        }

        function getEtaText(order) {
            const min = (Date.now() - order.placedAt) / 60000;
            const rem = Math.max(0, 30 - min);
            return `${Math.floor(rem)} min ${String(Math.floor((rem % 1) * 60)).padStart(2, '0')} sec`;
        }

        function renderCard(order) {
            const status = getStatus(order);
            const sc = STATUS_CONFIG[status];
            const items = order.items || [];
            const addr = order.deliveryAddr || {};
            const addrStr = addr.street ? `${addr.type || 'Home'}: ${addr.street}, ${addr.city}` : (order.city || 'Your address');
            const total = order.total || 0;

            let mrpTotal = 0;
            items.forEach(({ med, qty }) => { const m = getMed(med.id); mrpTotal += (m.mrp || med.price) * qty; });
            const discount = mrpTotal - total;

            const placedAt = new Date(order.placedAt);
            const now = new Date();
            const isToday = placedAt.toDateString() === now.toDateString();
            const timeStr = isToday
                ? `Today, ${placedAt.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })}`
                : placedAt.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' }) + ', ' +
                placedAt.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });

            const STEP_DEFS = [
                { icon: '‚úì', label: 'Placed' },
                { icon: '‚úì', label: 'Confirmed' },
                { icon: 'üì¶', label: 'Packing' },
                { icon: 'üö¥', label: 'On the Way' },
                { icon: 'üè†', label: 'Delivered' },
            ];

            const stepsHTML = STEP_DEFS.map((s, i) => {
                const done = i < sc.activeStep;
                const active = i === sc.activeStep;
                return `<div class="t-step ${done ? 'done' : active ? 'active' : ''}">
        <div class="t-icon">${done ? '‚úì' : s.icon}</div>
        <div class="t-label">${s.label}</div>
      </div>`;
            }).join('');

            let etaBoxHTML = '';
            if (status === 'delivered') {
                etaBoxHTML = `<div class="eta-box" style="background:#f0fdf4;border-color:#bbf7d0;">
        <div class="eta-icon">‚úÖ</div>
        <div>
          <div class="eta-label" style="color:#15803d;">DELIVERED SUCCESSFULLY</div>
          <div class="eta-time" style="color:#15803d;">In just 27 mins! ‚ö°</div>
        </div>
      </div>`;
            } else {
                etaBoxHTML = `<div class="eta-box" style="background:${sc.etaBg};border-color:${sc.etaBorder};">
        <div class="eta-icon">${sc.etaIcon}</div>
        <div>
          <div class="eta-label" style="color:${sc.etaColor};">‚è± ${sc.etaLabel}</div>
          <div class="eta-time" id="eta-${order.orderId}" style="color:${sc.etaColor};">${getEtaText(order)}</div>
          <div class="eta-addr">üìç ${addrStr}</div>
        </div>
      </div>`;
            }

            const itemsHTML = items.map(({ med, qty }) => {
                const m = getMed(med.id);
                const off = Math.round((1 - (med.price / (m.mrp || med.price * 1.25))) * 100);
                return `<div class="med-item">
        <div class="med-img">üíä<span class="med-off">${off}%</span></div>
        <div class="med-info">
          <div class="med-name">${med.name}</div>
          <div class="med-sub">${m.sub || med.sub || ''}</div>
        </div>
        <div class="med-price">
          <div class="curr">‚Çπ${med.price * qty}</div>
          <div class="orig">‚Çπ${(m.mrp || Math.round(med.price * 1.25)) * qty}</div>
          <div class="qty">Qty: ${qty}</div>
        </div>
      </div>`;
            }).join('');

            let actionsHTML = '';
            if (status === 'delivered') {
                actionsHTML = `<button class="btn btn-primary" onclick="reorder('${order.orderId}')">üîÑ Reorder</button><button class="btn btn-outline">‚≠ê Rate Order</button>`;
            } else if (status === 'confirmed') {
                actionsHTML = `<button class="btn btn-red" onclick="cancelOrder('${order.orderId}')">‚úï Cancel Order</button>`;
            } else if (status === 'on_the_way') {
                actionsHTML = `<button class="btn btn-outline" onclick="showToast('üìû Calling rider...')">üìû Call Rider</button>`;
            }

            return `<div class="order-card" data-status="${status === 'delivered' ? 'delivered' : 'active'}">
      <div class="order-top">
        <div class="order-meta">
          <span class="order-id-tag">${order.orderId}</span>
          <div class="order-date">Placed: <strong>${timeStr}</strong></div>
        </div>
        <span class="badge ${sc.badge}"><span class="badge-dot"></span> ${sc.label}</span>
      </div>
      <div class="order-body">
        <div class="order-left">
          <div class="section-label">üíä Medicines Ordered</div>
          ${itemsHTML}
        </div>
        <div class="order-right">
          <div class="section-label">üìç Order Tracking</div>
          ${etaBoxHTML}
          <div class="tracker-steps">${stepsHTML}</div>
          <div class="section-label">üí∞ Price Details</div>
          <div class="price-box">
            <div class="price-row"><span>MRP Total</span><span>‚Çπ${mrpTotal}</span></div>
            <div class="price-row"><span>Discount</span><span class="save">-‚Çπ${Math.max(0, discount)}</span></div>
            <div class="price-row"><span>Delivery</span><span class="save">FREE</span></div>
            <div class="price-row total"><span>Amount Paid</span><span>‚Çπ${total}</span></div>
          </div>
        </div>
      </div>
      <div class="order-actions">
        <div class="order-total-tag">Total: <strong>‚Çπ${total}</strong> ¬∑ ${order.payMethod || 'Paid'}</div>
        <div class="action-btns">${actionsHTML}</div>
      </div>
    </div>`;
        }

        function renderAll() {
            loadOrders();

            const active = orders.filter(o => getStatus(o) !== 'delivered');
            const delivered = orders.filter(o => getStatus(o) === 'delivered');
            const spent = orders.reduce((s, o) => s + (o.total || 0), 0);

            document.getElementById('statTotal').textContent = orders.length;
            document.getElementById('statActive').textContent = active.length;
            document.getElementById('statDelivered').textContent = delivered.length;
            document.getElementById('statSpent').textContent = '‚Çπ' + spent;
            document.getElementById('cntAll').textContent = orders.length;
            document.getElementById('cntActive').textContent = active.length;
            document.getElementById('cntDelivered').textContent = delivered.length;

            let filtered = orders;
            if (currentTab === 'active') filtered = active;
            if (currentTab === 'delivered') filtered = delivered;

            const list = document.getElementById('ordersList');
            if (filtered.length === 0) {
                const msgs = { all: 'Koi order nahi abhi tak', active: 'Koi active order nahi', delivered: 'Koi delivered order nahi' };
                list.innerHTML = `<div class="empty-state">
        <div class="ei">üìã</div>
        <h3>${msgs[currentTab]}</h3>
        <p>Medicines order karo aur 30 minutes mein paao!</p>
        <a href="all-medicines.html" class="shop-btn">üíä Order Medicines Now</a>
      </div>`;
                return;
            }

            list.innerHTML = filtered.map(renderCard).join('');
        }

        function switchTab(tab) {
            currentTab = tab;
            ['all', 'active', 'delivered'].forEach(t => {
                const el = document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1));
                if (el) el.classList.toggle('active', t === tab);
            });
            renderAll();
        }

        function cancelOrder(orderId) {
            if (!confirm('Order cancel karna chahte hain?')) return;
            try {
                let stored = JSON.parse(localStorage.getItem('mq_orders') || '[]');
                stored = stored.filter(o => o.orderId !== orderId);
                localStorage.setItem('mq_orders', JSON.stringify(stored));
                showToast('‚úì Order cancel ho gaya!');
                renderAll();
            } catch (e) { }
        }

        function reorder(orderId) {
            showToast('üõí Medicines cart mein jaoge...');
            setTimeout(() => window.location.href = 'all-medicines.html', 1200);
        }

        let toastTimer;
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            clearTimeout(toastTimer);
            toastTimer = setTimeout(() => t.classList.remove('show'), 2500);
        }

        // Initial render
        renderAll();

        // Update ETA timers every second (lightweight)
        setInterval(() => {
            loadOrders();
            orders.forEach(order => {
                const el = document.getElementById(`eta-${order.orderId}`);
                if (el) el.textContent = getEtaText(order);
            });
        }, 1000);

        // Full re-render every 30 seconds to advance status badges
        setInterval(renderAll, 30000);
    </script>
</body>

</html>